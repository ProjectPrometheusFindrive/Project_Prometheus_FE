openapi: 3.0.3
info:
  title: Project Prometheus Fleet API
  description: |
    Project Prometheus 프론트엔드가 기대하는 백엔드 REST API 명세입니다.

    * `VITE_FAKE_API_BASE_URL`(기본 `http://localhost:3001/api`)로 구동되는 Fake API는 리소스(JSON) 자체를 반환합니다.
    * 실제 백엔드(`VITE_API_BASE_URL`)는 `status/data/error/timestamp` 래퍼를 사용하는 것을 권장합니다.

    이 OpenAPI 파일은 두 형태의 응답을 모두 허용하도록 `oneOf` 스키마를 사용합니다.
  version: 1.0.0
  license:
    name: Proprietary
    url: https://prometheus.test/license
servers:
  - url: http://{devHost}:{port}/api
    description: 로컬 개발 Fake API 서버(기본값은 http://localhost:3001/api)
    variables:
      devHost:
        default: dev.prometheus.test
        description: 개발용 호스트명
      port:
        default: "3001"
        description: 개발 서버 포트
  - url: https://api.prometheus.test
    description: 실제 백엔드 API (환경 변수 `VITE_API_BASE_URL`로 설정)
security: []
tags:
  - name: Assets
    description: 차량 자산(Asset) 관리
  - name: Rentals
    description: 렌탈 계약 관리
  - name: Vehicles
    description: 자산/렌탈 통합 차량 스냅샷
  - name: Dashboard
    description: 대시보드용 집계 데이터
  - name: Problem Vehicles
    description: 도난·연체 등 이슈 차량 목록
  - name: Geofences
    description: 지오펜스/회사 설정 연계 데이터
  - name: Company
    description: 회사 기본 정보 및 지오펜스 저장
  - name: Issues
    description: 문제 차량 신고·초안 생성
paths:
  /assets:
    get:
      tags: [Assets]
      summary: 자산 목록 조회
      operationId: listAssets
      description: 차량 자산 전체 목록을 반환합니다.
      responses:
        "200":
          description: 자산 목록
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/Asset'
                  - type: array
                    items:
                      $ref: '#/components/schemas/Asset'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Assets]
      summary: 신규 자산 생성
      operationId: createAsset
      description: 신규 차량 자산을 등록합니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetCreateInput'
      responses:
        "201":
          description: 생성된 자산
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Asset'
                  - $ref: '#/components/schemas/Asset'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /assets/{assetId}:
    parameters:
      - $ref: '#/components/parameters/AssetIdParam'
    get:
      tags: [Assets]
      summary: 자산 상세 조회
      operationId: getAsset
      responses:
        "200":
          description: 자산 상세 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Asset'
                  - $ref: '#/components/schemas/Asset'
        "404":
          $ref: '#/components/responses/Error'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Assets]
      summary: 자산 정보 수정
      operationId: updateAsset
      description: 부분 업데이트(PUT 또는 PATCH)를 수행합니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetUpdateInput'
      responses:
        "200":
          description: 수정된 자산 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Asset'
                  - $ref: '#/components/schemas/Asset'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [Assets]
      summary: 자산 삭제
      operationId: deleteAsset
      responses:
        "204":
          description: 삭제 완료
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /rentals:
    get:
      tags: [Rentals]
      summary: 렌탈 계약 목록 조회
      operationId: listRentals
      responses:
        "200":
          description: 렌탈 계약 목록
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/Rental'
                  - type: array
                    items:
                      $ref: '#/components/schemas/Rental'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    post:
      tags: [Rentals]
      summary: 신규 렌탈 계약 생성
      operationId: createRental
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RentalCreateInput'
      responses:
        "201":
          description: 생성된 렌탈 계약
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Rental'
                  - $ref: '#/components/schemas/Rental'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /rentals/latest:
    get:
      tags: [Rentals]
      summary: VIN별 최신 렌탈 계약 조회
      operationId: listLatestRentals
      description: 각 VIN의 최신 렌탈 1건을 반환합니다.
      responses:
        "200":
          description: 최신 렌탈 목록
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/Rental'
                  - type: array
                    items:
                      $ref: '#/components/schemas/Rental'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /rentals/{rentalId}:
    parameters:
      - $ref: '#/components/parameters/RentalIdParam'
    get:
      tags: [Rentals]
      summary: 렌탈 계약 상세 조회
      operationId: getRental
      responses:
        "200":
          description: 렌탈 계약 상세 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Rental'
                  - $ref: '#/components/schemas/Rental'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Rentals]
      summary: 렌탈 계약 수정
      operationId: updateRental
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RentalUpdateInput'
      responses:
        "200":
          description: 수정된 렌탈 계약
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Rental'
                  - $ref: '#/components/schemas/Rental'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    delete:
      tags: [Rentals]
      summary: 렌탈 계약 삭제
      operationId: deleteRental
      responses:
        "204":
          description: 삭제 완료
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /rentals/byVin/{vin}:
    parameters:
      - $ref: '#/components/parameters/VinParam'
    get:
      tags: [Rentals]
      summary: 특정 VIN의 렌탈 상태 집계
      operationId: getRentalStatusByVin
      responses:
        "200":
          description: 렌탈 상태 집계 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/RentalStatusAggregate'
                  - $ref: '#/components/schemas/RentalStatusAggregate'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /vehicles:
    get:
      tags: [Vehicles]
      summary: 차량 스냅샷 목록 조회
      operationId: listVehicles
      description: 자산과 렌탈 정보를 결합한 차량 스냅샷 목록을 반환합니다.
      responses:
        "200":
          description: 차량 스냅샷 목록
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/VehicleSnapshot'
                  - type: array
                    items:
                      $ref: '#/components/schemas/VehicleSnapshot'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /dashboard:
    get:
      tags: [Dashboard]
      summary: 대시보드 데이터 조회
      operationId: getDashboard
      responses:
        "200":
          description: 대시보드 집계 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/DashboardSummary'
                  - $ref: '#/components/schemas/DashboardSummary'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /problem-vehicles:
    get:
      tags: [Problem Vehicles]
      summary: 문제 차량 목록 조회
      operationId: listProblemVehicles
      responses:
        "200":
          description: 이슈 차량 목록
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/ProblemVehicle'
                  - type: array
                    items:
                      $ref: '#/components/schemas/ProblemVehicle'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /geofences:
    get:
      tags: [Geofences]
      summary: 지오펜스 목록 조회
      operationId: listGeofences
      description: 설정된 지오펜스 좌표 목록을 반환합니다.
      responses:
        "200":
          description: 지오펜스 목록
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: array
                            items:
                              $ref: '#/components/schemas/Geofence'
                  - type: array
                    items:
                      $ref: '#/components/schemas/Geofence'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /company:
    get:
      tags: [Company]
      summary: 회사 정보 조회
      operationId: getCompanyInfo
      responses:
        "200":
          description: 회사 기본 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Company'
                  - $ref: '#/components/schemas/Company'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
    put:
      tags: [Company]
      summary: 회사 정보 저장
      operationId: updateCompanyInfo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Company'
      responses:
        "200":
          description: 저장 성공 여부
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            type: object
                            properties:
                              ok:
                                type: boolean
                          status:
                            enum: [success]
                  - type: object
                    properties:
                      ok:
                        type: boolean
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /issues:
    post:
      tags: [Issues]
      summary: 문제 차량 이슈 등록 (실제 백엔드)
      operationId: createIssue
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IssueCreateInput'
      responses:
        "201":
          description: 생성된 이슈 정보
          content:
            application/json:
              schema:
                oneOf:
                  - allOf:
                      - $ref: '#/components/schemas/StandardResponse'
                      - type: object
                        properties:
                          data:
                            $ref: '#/components/schemas/Issue'
                  - $ref: '#/components/schemas/Issue'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
  /issue-drafts:
    post:
      tags: [Issues]
      summary: 문제 차량 이슈 초안 생성 (Fake API 전용)
      operationId: createIssueDraft
      description: 로컬 개발용 Fake API에서만 제공되는 엔드포인트입니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IssueCreateInput'
      responses:
        "201":
          description: 생성된 이슈 초안
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Issue'
        "400":
          $ref: '#/components/responses/Error'
        default:
          $ref: '#/components/responses/Error'
components:
  parameters:
    AssetIdParam:
      name: assetId
      in: path
      required: true
      schema:
        type: string
      description: 자산 ID
    RentalIdParam:
      name: rentalId
      in: path
      required: true
      schema:
        type: string
      description: 렌탈 계약 ID
    VinParam:
      name: vin
      in: path
      required: true
      schema:
        type: string
        minLength: 17
        maxLength: 17
      description: 차량 VIN(17자리)
  responses:
    Error:
      description: 오류 응답
      content:
        application/json:
          schema:
            oneOf:
              - allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      status:
                        enum: [error]
                      error:
                        allOf:
                          - $ref: '#/components/schemas/ErrorDetail'
              - $ref: '#/components/schemas/PlainError'
  schemas:
    StandardResponse:
      type: object
      required: [status, timestamp]
      properties:
        status:
          type: string
          enum: [success, error]
        timestamp:
          type: string
          format: date-time
        error:
          type: object
          nullable: true
          allOf:
            - $ref: '#/components/schemas/ErrorDetail'
      description: 실제 백엔드에서 사용하는 표준 응답 래퍼
    ErrorDetail:
      type: object
      required: [type, message]
      properties:
        type:
          type: string
          enum: [NETWORK_ERROR, NOT_FOUND, UNAUTHORIZED, VALIDATION_ERROR, SERVER_ERROR]
        message:
          type: string
    PlainError:
      type: object
      properties:
        error:
          oneOf:
            - type: string
            - $ref: '#/components/schemas/ErrorDetail'
    GeoPoint:
      type: object
      required: [lat, lng]
      properties:
        lat:
          type: number
          format: double
        lng:
          type: number
          format: double
    InsuranceHistoryEntry:
      type: object
      properties:
        type:
          type: string
          enum: ["등록", "갱신"]
        date:
          type: string
          format: date
        company:
          type: string
        product:
          type: string
        startDate:
          type: string
          format: date
        expiryDate:
          type: string
          format: date
        specialTerms:
          type: string
        docName:
          type: string
        docDataUrl:
          type: string
      description: 보험 이력 항목
    DeviceHistoryEntry:
      type: object
      properties:
        type:
          type: string
          enum: [install, replace, update]
        date:
          type: string
          format: date
        installDate:
          type: string
          format: date
        serial:
          type: string
        installer:
          type: string
    Asset:
      type: object
      required:
        - id
        - vin
        - plate
      properties:
        id:
          type: string
          description: 자산 고유 ID
        vin:
          type: string
          minLength: 17
          maxLength: 17
          description: 차량 VIN(17자리)
        plate:
          type: string
          description: 차량 번호판
        make:
          type: string
          nullable: true
          description: 제조사
        model:
          type: string
          nullable: true
          description: 모델명
        vehicleType:
          type: string
          nullable: true
          description: UI에 표시되는 차종(제조사/모델/연식 조합)
        year:
          type: integer
          nullable: true
          description: 제조 연도
        fuelType:
          type: string
          nullable: true
          description: 연료 종류
        color:
          type: string
          nullable: true
          description: 외관 색상
        vehicleValue:
          type: number
          format: double
          nullable: true
          description: 차량가액(원)
        purchaseDate:
          type: string
          format: date
          nullable: true
          description: 차량 구매일
        systemRegDate:
          type: string
          format: date
          nullable: true
          description: 전산 등록 일자
        systemDelDate:
          type: string
          format: date
          nullable: true
          description: 전산 삭제 일자
        registrationDate:
          type: string
          format: date
          nullable: true
          description: 등록 일자
        registrationStatus:
          type: string
          nullable: true
          description: 등록/장비 상태
        vehicleStatus:
          type: string
          nullable: true
          description: 원본 데이터상의 차량 상태
        managementStage:
          type: string
          nullable: true
          description: 차량 관리 단계(프론트에서 상태 필터로 사용)
          enum: ["대여중", "대여가능", "예약중", "입고 대상", "수리/점검 중", "수리/점검 완료"]
        diagnosticStatus:
          type: string
          nullable: true
          enum: ["-", "정상", "관심필요", "조치필요"]
          description: 진단 배지 상태
        diagnosticCodes:
          type: object
          nullable: true
          description: 진단 카테고리별 코드 개수
          properties:
            category1:
              type: integer
            category2:
              type: integer
            category3:
              type: integer
            category4:
              type: integer
        deviceSerial:
          type: string
          nullable: true
          description: 장비 시리얼 번호
        deviceInstallDate:
          type: string
          format: date
          nullable: true
          description: 장비 설치 일자
        installer:
          type: string
          nullable: true
          description: 장비 설치 담당자
        deviceHistory:
          type: array
          items:
            $ref: '#/components/schemas/DeviceHistoryEntry'
          description: 장비 설치/교체 이력
        insuranceInfo:
          type: string
          nullable: true
          description: 보험 정보 요약(회사 + 상품)
        insuranceCompany:
          type: string
          nullable: true
        insuranceProduct:
          type: string
          nullable: true
        insuranceStartDate:
          type: string
          format: date
          nullable: true
        insuranceExpiryDate:
          type: string
          format: date
          nullable: true
        insuranceSpecialTerms:
          type: string
          nullable: true
        insuranceDocName:
          type: string
          nullable: true
        insuranceDocDataUrl:
          type: string
          nullable: true
          description: 보험 증빙 파일(Data URL 등)
        insuranceHistory:
          type: array
          items:
            $ref: '#/components/schemas/InsuranceHistoryEntry'
        memo:
          type: string
          nullable: true
        rental:
          description: 현재 연결된 렌탈 정보(배열이거나 단일 객체)
          oneOf:
            - $ref: '#/components/schemas/Rental'
            - type: array
              items:
                $ref: '#/components/schemas/Rental'
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
    AssetCreateInput:
      type: object
      required: [vin, plate, make, model]
      properties:
        vin:
          type: string
          minLength: 17
          maxLength: 17
        plate:
          type: string
        make:
          type: string
        model:
          type: string
        vehicleType:
          type: string
        year:
          type: integer
        fuelType:
          type: string
        color:
          type: string
        vehicleValue:
          type: number
          format: double
        purchaseDate:
          type: string
          format: date
        systemRegDate:
          type: string
          format: date
        systemDelDate:
          type: string
          format: date
        registrationStatus:
          type: string
        registrationDate:
          type: string
          format: date
        vehicleStatus:
          type: string
        managementStage:
          type: string
          enum: ["대여중", "대여가능", "예약중", "입고 대상", "수리/점검 중", "수리/점검 완료"]
        diagnosticStatus:
          type: string
          enum: ["-", "정상", "관심필요", "조치필요"]
        diagnosticCodes:
          type: object
          properties:
            category1:
              type: integer
            category2:
              type: integer
            category3:
              type: integer
            category4:
              type: integer
        deviceSerial:
          type: string
        deviceInstallDate:
          type: string
          format: date
        installer:
          type: string
        deviceHistory:
          type: array
          items:
            $ref: '#/components/schemas/DeviceHistoryEntry'
        insuranceInfo:
          type: string
        insuranceCompany:
          type: string
        insuranceProduct:
          type: string
        insuranceStartDate:
          type: string
          format: date
        insuranceExpiryDate:
          type: string
          format: date
        insuranceSpecialTerms:
          type: string
        insuranceDocName:
          type: string
        insuranceDocDataUrl:
          type: string
        insuranceHistory:
          type: array
          items:
            $ref: '#/components/schemas/InsuranceHistoryEntry'
        memo:
          type: string
    AssetUpdateInput:
      type: object
      description: 자산 업데이트 시 전달 가능한 필드 (부분 업데이트 허용)
      properties:
        plate:
          type: string
        make:
          type: string
        model:
          type: string
        vehicleType:
          type: string
        year:
          type: integer
        fuelType:
          type: string
        color:
          type: string
        vehicleValue:
          type: number
          format: double
        purchaseDate:
          type: string
          format: date
        systemRegDate:
          type: string
          format: date
        systemDelDate:
          type: string
          format: date
        registrationStatus:
          type: string
        registrationDate:
          type: string
          format: date
        vehicleStatus:
          type: string
        managementStage:
          type: string
          enum: ["대여중", "대여가능", "예약중", "입고 대상", "수리/점검 중", "수리/점검 완료"]
        diagnosticStatus:
          type: string
          enum: ["-", "정상", "관심필요", "조치필요"]
        diagnosticCodes:
          type: object
          properties:
            category1:
              type: integer
            category2:
              type: integer
            category3:
              type: integer
            category4:
              type: integer
        deviceSerial:
          type: string
        deviceInstallDate:
          type: string
          format: date
        installer:
          type: string
        deviceHistory:
          type: array
          items:
            $ref: '#/components/schemas/DeviceHistoryEntry'
        insuranceInfo:
          type: string
        insuranceCompany:
          type: string
        insuranceProduct:
          type: string
        insuranceStartDate:
          type: string
          format: date
        insuranceExpiryDate:
          type: string
          format: date
        insuranceSpecialTerms:
          type: string
        insuranceDocName:
          type: string
        insuranceDocDataUrl:
          type: string
        insuranceHistory:
          type: array
          items:
            $ref: '#/components/schemas/InsuranceHistoryEntry'
        memo:
          type: string
    RentalCustomer:
      type: object
      required: [name, phone, address, licenseNumber]
      properties:
        name:
          type: string
        phone:
          type: string
        address:
          type: string
        licenseNumber:
          type: string
    RentalPeriod:
      type: object
      required: [start, end]
      properties:
        start:
          type: string
          pattern: '^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:Z|[+-]\\d{2}:\\d{2})?$'
          description: ISO 8601 형식(타임존 표기는 선택 사항)
          example: 2025-09-10T09:00:00
        end:
          type: string
          pattern: '^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:Z|[+-]\\d{2}:\\d{2})?$'
          description: ISO 8601 형식(타임존 표기는 선택 사항)
          example: 2025-10-10T18:00:00
    AccidentReport:
      type: object
      description: 사고 접수 정보 (있을 경우)
      properties:
        accidentDate:
          type: string
          format: date
        accidentHour:
          type: string
        accidentMinute:
          type: string
        accidentSecond:
          type: string
        handlerName:
          type: string
        accidentDateTime:
          type: string
          pattern: '^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:Z|[+-]\\d{2}:\\d{2})?$'
          description: ISO 8601 형식(타임존 표기는 선택 사항)
        accidentDisplayTime:
          type: string
        blackboxFile:
          type: string
          nullable: true
        blackboxFileName:
          type: string
          nullable: true
        recordedAt:
          type: string
          format: date-time
    Rental:
      type: object
      required:
        - rental_id
        - vin
        - rental_period
      properties:
        rental_id:
          oneOf:
            - type: string
            - type: integer
              format: int64
          description: 렌탈 계약 고유 ID
        vin:
          type: string
          minLength: 17
          maxLength: 17
          description: 차량 VIN
        vehicleType:
          type: string
          nullable: true
        plate:
          type: string
          nullable: true
        renter_name:
          type: string
          nullable: true
        contact_number:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        customer:
          $ref: '#/components/schemas/RentalCustomer'
          nullable: true
          description: 실서비스에서 사용할 수 있는 구조화된 고객 정보
        rental_period:
          $ref: '#/components/schemas/RentalPeriod'
        insurance_name:
          type: string
          nullable: true
        rental_amount:
          type: number
          format: double
          nullable: true
        contract_status:
          type: string
          nullable: true
        status:
          type: string
          nullable: true
        reported_stolen:
          type: boolean
          nullable: true
        return_confirmed:
          type: boolean
          nullable: true
        accident_reported:
          type: boolean
          nullable: true
        accidentReport:
          $ref: '#/components/schemas/AccidentReport'
          nullable: true
        rental_location:
          $ref: '#/components/schemas/GeoPoint'
          nullable: true
        return_location:
          $ref: '#/components/schemas/GeoPoint'
          nullable: true
        current_location:
          $ref: '#/components/schemas/GeoPoint'
          nullable: true
        engine_status:
          type: string
          nullable: true
          enum: [on, off]
        restart_blocked:
          type: boolean
          nullable: true
        memo:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true
    RentalCreateInput:
      type: object
      required: [vin, rental_period]
      properties:
        rental_id:
          oneOf:
            - type: string
            - type: integer
              format: int64
        vin:
          type: string
          minLength: 17
          maxLength: 17
        vehicleType:
          type: string
        plate:
          type: string
        renter_name:
          type: string
        contact_number:
          type: string
        address:
          type: string
        customer:
          $ref: '#/components/schemas/RentalCustomer'
        rental_period:
          $ref: '#/components/schemas/RentalPeriod'
        insurance_name:
          type: string
        rental_amount:
          type: number
          format: double
        contract_status:
          type: string
        status:
          type: string
        reported_stolen:
          type: boolean
        return_confirmed:
          type: boolean
        accident_reported:
          type: boolean
        accidentReport:
          $ref: '#/components/schemas/AccidentReport'
        rental_location:
          $ref: '#/components/schemas/GeoPoint'
        return_location:
          $ref: '#/components/schemas/GeoPoint'
        current_location:
          $ref: '#/components/schemas/GeoPoint'
        engine_status:
          type: string
          enum: [on, off]
        restart_blocked:
          type: boolean
        memo:
          type: string
        contract_file:
          type: string
          format: byte
          description: 계약서 파일(Base64 등 인코딩된 문자열)
        driver_license_file:
          type: string
          format: byte
          description: 운전면허 사본(Base64 등 인코딩된 문자열)
    RentalUpdateInput:
      type: object
      properties:
        renter_name:
          type: string
        contact_number:
          type: string
        address:
          type: string
        customer:
          $ref: '#/components/schemas/RentalCustomer'
        rental_period:
          $ref: '#/components/schemas/RentalPeriod'
        insurance_name:
          type: string
        rental_amount:
          type: number
          format: double
        contract_status:
          type: string
        status:
          type: string
        reported_stolen:
          type: boolean
        return_confirmed:
          type: boolean
        accident_reported:
          type: boolean
        accidentReport:
          $ref: '#/components/schemas/AccidentReport'
        rental_location:
          $ref: '#/components/schemas/GeoPoint'
        return_location:
          $ref: '#/components/schemas/GeoPoint'
        current_location:
          $ref: '#/components/schemas/GeoPoint'
        engine_status:
          type: string
          enum: [on, off]
        restart_blocked:
          type: boolean
        memo:
          type: string
        contract_file:
          type: string
          format: byte
        driver_license_file:
          type: string
          format: byte
    RentalStatusAggregate:
      type: object
      required: [current, stolen, active, overdue, reserved, conflicts, asOf]
      properties:
        current:
          type: object
          nullable: true
          allOf:
            - $ref: '#/components/schemas/Rental'
        stolen:
          type: array
          items:
            $ref: '#/components/schemas/Rental'
        active:
          type: array
          items:
            $ref: '#/components/schemas/Rental'
        overdue:
          type: array
          items:
            $ref: '#/components/schemas/Rental'
        reserved:
          type: array
          items:
            $ref: '#/components/schemas/Rental'
        conflicts:
          type: array
          items:
            $ref: '#/components/schemas/Rental'
        asOf:
          type: string
          format: date-time
    VehicleSnapshot:
      type: object
      required: [vin, assetId, plate, asset, rentals, status]
      properties:
        vin:
          type: string
          minLength: 17
          maxLength: 17
        assetId:
          type: string
        plate:
          type: string
        asset:
          $ref: '#/components/schemas/Asset'
        rentals:
          type: array
          items:
            $ref: '#/components/schemas/Rental'
        status:
          $ref: '#/components/schemas/RentalStatusAggregate'
    ProblemVehicle:
      type: object
      required: [rental_id, vin, rental_period, issue]
      properties:
        rental_id:
          oneOf:
            - type: string
            - type: integer
              format: int64
        vin:
          type: string
          minLength: 17
          maxLength: 17
        plate:
          type: string
          nullable: true
        vehicleType:
          type: string
          nullable: true
        renter_name:
          type: string
          nullable: true
        contact_number:
          type: string
          nullable: true
        asset:
          $ref: '#/components/schemas/Asset'
          nullable: true
        issue:
          type: string
        rental_period:
          $ref: '#/components/schemas/RentalPeriod'
        reported_stolen:
          type: boolean
          nullable: true
        rental_location:
          $ref: '#/components/schemas/GeoPoint'
          nullable: true
        return_location:
          $ref: '#/components/schemas/GeoPoint'
          nullable: true
        current_location:
          $ref: '#/components/schemas/GeoPoint'
          nullable: true
        engine_status:
          type: string
          enum: [on, off]
          nullable: true
        restart_blocked:
          type: boolean
          nullable: true
        memo:
          type: string
          nullable: true
    DashboardSummary:
      type: object
      required:
        - totalAssets
        - availableAssets
        - activeRentals
        - problemVehicles
        - overdueRentals
        - stolenVehicles
        - deviceInstalled
        - insuranceRegistered
        - vehicleStatus
        - bizStatus
        - recentActivities
      properties:
        totalAssets:
          type: integer
        availableAssets:
          type: integer
        activeRentals:
          type: integer
        problemVehicles:
          type: integer
        overdueRentals:
          type: integer
        stolenVehicles:
          type: integer
        deviceInstalled:
          type: integer
        insuranceRegistered:
          type: integer
        vehicleStatus:
          type: array
          items:
            $ref: '#/components/schemas/NamedMetric'
        bizStatus:
          type: array
          items:
            $ref: '#/components/schemas/NamedMetric'
        recentActivities:
          type: array
          items:
            $ref: '#/components/schemas/RecentActivity'
    NamedMetric:
      type: object
      required: [name, value]
      properties:
        name:
          type: string
        value:
          type: integer
    RecentActivity:
      type: object
      required: [id, type, message, timestamp]
      properties:
        id:
          type: integer
        type:
          type: string
        message:
          type: string
        timestamp:
          type: string
          format: date-time
    Geofence:
      type: object
      required: [name, points]
      properties:
        id:
          type: string
          description: 지오펜스 고유 ID
        name:
          type: string
        points:
          type: array
          items:
            $ref: '#/components/schemas/GeoPoint'
    Company:
      type: object
      required: [corpName, ceoName, regNumber, incorpDate, address]
      properties:
        corpName:
          type: string
        ceoName:
          type: string
        regNumber:
          type: string
        incorpDate:
          type: string
        address:
          type: string
        contactNumber:
          type: string
          nullable: true
        contactEmail:
          type: string
          format: email
          nullable: true
        logoDataUrl:
          type: string
          nullable: true
        certDataUrl:
          type: string
          nullable: true
        geofences:
          type: array
          items:
            $ref: '#/components/schemas/Geofence'
        geofencesUpdatedAt:
          type: string
          format: date-time
          nullable: true
    IssueCreateInput:
      type: object
      required: [vin, type, severity, description]
      properties:
        vin:
          type: string
          minLength: 17
          maxLength: 17
        type:
          type: string
          enum: [overdue, stolen, damage, other]
        severity:
          type: string
          enum: [low, medium, high]
        priority:
          type: string
          description: 선택적으로 우선순위를 별도로 기록할 수 있습니다.
        description:
          type: string
        reportedBy:
          type: string
    Issue:
      type: object
      required: [id, vin, type, severity, description, createdAt]
      properties:
        id:
          oneOf:
            - type: string
            - type: integer
              format: int64
        vin:
          type: string
        type:
          type: string
        severity:
          type: string
        priority:
          type: string
          nullable: true
        description:
          type: string
        reportedBy:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        status:
          type: string
          nullable: true

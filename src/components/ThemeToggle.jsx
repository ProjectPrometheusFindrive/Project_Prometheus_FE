import React, { useEffect, useState } from "react";
import { typedStorage } from "../utils/storage";

export default function ThemeToggle() {
  const getInitial = () => {
    const saved = typedStorage.prefs.getTheme();
    if (saved === "light" || saved === "dark") return saved;
    return "light";
  };

  const [theme, setTheme] = useState(getInitial);

  useEffect(() => {
    document.documentElement.setAttribute("data-theme", theme);
    typedStorage.prefs.setTheme(theme);
  }, [theme]);

  const toggle = () => setTheme((t) => (t === "dark" ? "light" : "dark"));

  const isDark = theme === "dark";
  const label = isDark ? "라이트 모드" : "다크 모드";

  return (
    <button
      type="button"
      onClick={toggle}
      aria-pressed={isDark}
      aria-label={label}
      title={label}
      className="top-header__icon-button"
    >
      {isDark ? (
        <svg width="26" height="26" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="34" height="34" rx="17" fill="#F8F8F8"/>
          <path d="M23.41 19.775c-0.092-0.085-0.229-0.101-0.339-0.043c-3.167 1.681-7.053 0.563-8.847-2.543c-1.793-3.106-0.818-7.03 2.22-8.933c0.106-0.067 0.159-0.193 0.132-0.315c-0.027-0.123-0.128-0.215-0.252-0.231c-1.969-0.253-3.918 0.139-5.639 1.132c-2.371 1.369-3.967 3.619-4.612 6.513c-0.646 2.893-0.065 5.819 1.68 8.461c1.745 2.641 4.41 4.299 7.707 4.794c0.91 0.137 1.823 0.205 2.733 0.205c1.559 0 3.098-0.409 4.484-1.209c1.72-0.993 3.034-2.486 3.799-4.317C23.544 20.458 23.502 19.86 23.41 19.775z" fill="#1C1C1C"/>
        </svg>
      ) : (
        <svg width="26" height="26" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="34" height="34" rx="17" fill="#F8F8F8"/>
          <path d="M16.625 9.75V7.6875C16.625 7.50516 16.6974 7.33032 16.8263 7.20136C16.9553 7.0724 17.1301 7 17.3125 7C17.4948 7 17.6697 7.0724 17.7986 7.20136C17.9276 7.33032 18 7.50516 18 7.6875V9.75C18 9.93234 17.9276 10.1072 17.7986 10.2361C17.6697 10.3651 17.4948 10.4375 17.3125 10.4375C17.1301 10.4375 16.9553 10.3651 16.8263 10.2361C16.6974 10.1072 16.625 9.93234 16.625 9.75ZM12.5938 12.2187C12.6581 12.283 12.7345 12.3342 12.8187 12.3694C12.9029 12.4047 12.9932 12.4232 13.0844 12.4241C13.1756 12.425 13.2662 12.4082 13.3511 12.3747C13.436 12.3412 13.5134 12.2916 13.5789 12.2285C13.6444 12.1654 13.6969 12.0901 13.7333 12.0067C13.7698 11.9233 13.7896 11.8334 13.7918 11.7423C13.794 11.6511 13.7784 11.5603 13.7461 11.4753C13.7137 11.3904 13.6651 11.3131 13.6031 11.2476L12.1437 9.78825C12.0781 9.72298 12.0005 9.67146 11.9155 9.63656C11.8306 9.60166 11.74 9.58403 11.6487 9.58462C11.5574 9.58521 11.467 9.604 11.3825 9.64001C11.298 9.67601 11.2211 9.72857 11.1562 9.79478C11.0914 9.86098 11.0399 9.9395 11.0049 10.0262C10.97 10.1128 10.9522 10.2057 10.9528 10.2991C10.9534 10.3925 10.972 10.4852 11.0079 10.5713C11.0437 10.6575 11.0961 10.7354 11.1619 10.8005L12.5938 12.2187ZM11.1619 23.8245C11.0962 23.8897 11.0439 23.9676 11.0082 24.0537C10.9724 24.1397 10.954 24.2323 10.9536 24.3256C10.9532 24.4189 10.9709 24.5117 11.0058 24.5981C11.0406 24.6846 11.0921 24.7631 11.1569 24.8293C11.2217 24.8955 11.2986 24.948 11.383 24.984C11.4675 25.02 11.5579 25.0388 11.6492 25.0394C11.7405 25.04 11.8311 25.0223 11.916 24.9874C12.001 24.9525 12.0785 24.901 12.1441 24.8357L13.6031 23.3774C13.734 23.2482 13.8077 23.0723 13.8082 22.8887C13.8087 22.7051 13.7359 22.5288 13.6057 22.3989C13.4756 22.2691 13.2991 22.197 13.1155 22.1975C12.9319 22.1979 12.7558 22.2709 12.6262 22.4014L11.1619 23.8245ZM9.75 16.625H7.6875C7.50516 16.625 7.33032 16.6974 7.20136 16.8263C7.0724 16.9553 7 17.1301 7 17.3125C7 17.4948 7.0724 17.6697 7.20136 17.7986C7.33032 17.9276 7.50516 18 7.6875 18H9.75C9.93234 18 10.1072 17.9276 10.2361 17.7986C10.3651 17.6697 10.4375 17.4948 10.4375 17.3125C10.4375 17.1301 10.3651 16.9553 10.2361 16.8263C10.1072 16.6974 9.93234 16.625 9.75 16.625ZM12.1441 9.78825C12.2785 9.65571 12.4549 9.58169 12.6391 9.58169C12.8233 9.58169 12.9997 9.65571 13.1341 9.78825C13.2666 9.92268 13.3406 10.1991 13.3406 10.3833C13.3406 10.5675 13.2666 10.7439 13.1341 10.8783L11.6758 12.3367C11.6102 12.4038 11.5321 12.4572 11.4461 12.494C11.3601 12.5308 11.2679 12.5503 11.1747 12.5514C11.0815 12.5524 10.9889 12.535 10.902 12.5002C10.8152 12.4653 10.736 12.4137 10.6692 12.3482C10.6024 12.2826 10.5493 12.2044 10.5129 12.1184C10.4765 12.0324 10.4575 11.9401 10.4569 11.8469C10.4564 11.7536 10.4744 11.6612 10.5097 11.5748C10.5451 11.4884 10.5973 11.4097 10.6633 11.3432L12.1441 9.78825ZM23.8379 10.8005C23.9037 10.7354 23.9561 10.6575 23.992 10.5713C24.0278 10.4852 24.0465 10.3925 24.0471 10.2991C24.0476 10.2057 24.0299 10.1128 23.9949 10.0262C23.96 9.9395 23.9084 9.86098 23.8436 9.79478C23.7788 9.72857 23.7019 9.67601 23.6174 9.64001C23.5329 9.604 23.4425 9.58521 23.3512 9.58462C23.2599 9.58403 23.1693 9.60166 23.0843 9.63656C22.9994 9.67146 22.9218 9.72298 22.8562 9.78825L21.3968 11.2476C21.3348 11.3131 21.2862 11.3904 21.2538 11.4753C21.2215 11.5603 21.2059 11.6511 21.2081 11.7423C21.2103 11.8334 21.2301 11.9233 21.2666 12.0067C21.303 12.0901 21.3555 12.1654 21.421 12.2285C21.4865 12.2916 21.5639 12.3412 21.6488 12.3747C21.7337 12.4082 21.8243 12.425 21.9155 12.4241C22.0067 12.4232 22.097 12.4047 22.1812 12.3694C22.2654 12.3342 22.3418 12.283 22.4061 12.2187L23.8379 10.8005ZM26.9375 16.625H24.875C24.6927 16.625 24.5178 16.6974 24.3889 16.8263C24.2599 16.9553 24.1875 17.1301 24.1875 17.3125C24.1875 17.4948 24.2599 17.6697 24.3889 17.7986C24.5178 17.9276 24.6927 18 24.875 18H26.9375C27.1198 18 27.2947 17.9276 27.4236 17.7986C27.5526 17.6697 27.625 17.4948 27.625 17.3125C27.625 17.1301 27.5526 16.9553 27.4236 16.8263C27.2947 16.6974 27.1198 16.625 26.9375 16.625ZM22.4061 22.4014C22.3411 22.3353 22.2639 22.2827 22.179 22.2467C22.0942 22.2107 22.0034 22.1921 21.9118 22.1916C21.8201 22.1912 21.7292 22.209 21.644 22.2441C21.5587 22.2791 21.481 22.3309 21.4154 22.3964C21.3498 22.462 21.298 22.5397 21.263 22.625C21.2279 22.7102 21.2101 22.8011 21.2106 22.8928C21.211 22.9844 21.2296 23.0752 21.2656 23.16C21.3016 23.2449 21.3542 23.3221 21.4203 23.3871L22.8787 24.8454C22.9443 24.9107 23.0218 24.9622 23.1068 24.9971C23.1917 25.032 23.2823 25.0497 23.3736 25.0491C23.4649 25.0486 23.5553 25.0298 23.6398 24.9938C23.7243 24.9578 23.8012 24.9052 23.866 24.839C23.9308 24.7728 23.9823 24.6943 24.0173 24.6077C24.0522 24.5212 24.07 24.4283 24.0694 24.335C24.0689 24.2417 24.0501 24.1491 24.0143 24.063C23.9784 23.9769 23.9262 23.899 23.8606 23.8339L22.4061 22.4014ZM17.3125 24.1875C17.1301 24.1875 16.9553 24.2599 16.8263 24.3889C16.6974 24.5178 16.625 24.6927 16.625 24.875V26.9375C16.625 27.1198 16.6974 27.2947 16.8263 27.4236C16.9553 27.5526 17.1301 27.625 17.3125 27.625C17.4948 27.625 17.6697 27.5526 17.7986 27.4236C17.9276 27.2947 18 27.1198 18 26.9375V24.875C18 24.6927 17.9276 24.5178 17.7986 24.3889C17.6697 24.2599 17.4948 24.1875 17.3125 24.1875ZM17.3125 12.0312C15.962 12.0312 14.6668 12.5683 13.7134 13.5217C12.76 14.4751 12.2228 15.7703 12.2228 17.1208C12.2228 18.4713 12.76 19.7665 13.7134 20.7199C14.6668 21.6733 15.962 22.2104 17.3125 22.2104C18.663 22.2104 19.9582 21.6733 20.9116 20.7199C21.865 19.7665 22.4021 18.4713 22.4021 17.1208C22.4021 15.7703 21.865 14.4751 20.9116 13.5217C19.9582 12.5683 18.663 12.0312 17.3125 12.0312Z" fill="#1C1C1C"/>
        </svg>
      )}
    </button>
  );
}

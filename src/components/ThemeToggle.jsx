import React, { useEffect, useState } from "react";
import { typedStorage } from "../utils/storage";

export default function ThemeToggle() {
  const getInitial = () => {
    const saved = typedStorage.prefs.getTheme();
    if (saved === "light" || saved === "dark") return saved;
    return "light";
  };

  const [theme, setTheme] = useState(getInitial);

  useEffect(() => {
    document.documentElement.setAttribute("data-theme", theme);
    typedStorage.prefs.setTheme(theme);
  }, [theme]);

  const toggle = () => setTheme((t) => (t === "dark" ? "light" : "dark"));

  const isDark = theme === "dark";
  const label = isDark ? "라이트 모드" : "다크 모드";

  return (
    <button
      type="button"
      onClick={toggle}
      aria-pressed={isDark}
      aria-label={label}
      title={label}
      className="top-header__icon-button top-header__theme-toggle"
    >
      {isDark ? (
        <svg width="26" height="26" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="34" height="34" rx="17" fill="#F8F8F8" />
          <path d="M16.625 9.75V7.6875C16.625 7.50516 16.6974 7.3303 16.8264 7.20136C16.9553 7.07243 17.1302 7 17.3125 7C17.4948 7 17.6697 7.07243 17.7986 7.20136C17.9276 7.3303 18 7.50516 18 7.6875V9.75C18 9.93234 17.9276 10.1072 17.7986 10.2361C17.6697 10.3651 17.4948 10.4375 17.3125 10.4375C17.1302 10.4375 16.9553 10.3651 16.8264 10.2361C16.6974 10.1072 16.625 9.93234 16.625 9.75ZM22.8125 17.3125C22.8125 18.4003 22.4899 19.4637 21.8856 20.3681C21.2812 21.2726 20.4223 21.9776 19.4173 22.3938C18.4123 22.8101 17.3064 22.919 16.2395 22.7068C15.1726 22.4946 14.1926 21.9708 13.4234 21.2016C12.6542 20.4324 12.1304 19.4524 11.9182 18.3855C11.706 17.3186 11.8149 16.2127 12.2312 15.2077C12.6474 14.2027 13.3524 13.3438 14.2569 12.7394C15.1613 12.1351 16.2247 11.8125 17.3125 11.8125C18.7707 11.8141 20.1687 12.3941 21.1998 13.4252C22.2309 14.4563 22.8109 15.8543 22.8125 17.3125ZM21.4375 17.3125C21.4375 16.4967 21.1956 15.6991 20.7423 15.0208C20.2891 14.3424 19.6448 13.8137 18.8911 13.5015C18.1373 13.1893 17.3079 13.1076 16.5078 13.2668C15.7076 13.4259 14.9726 13.8188 14.3957 14.3957C13.8188 14.9726 13.4259 15.7076 13.2668 16.5078C13.1076 17.3079 13.1893 18.1373 13.5015 18.8911C13.8137 19.6448 14.3424 20.2891 15.0208 20.7423C15.6991 21.1956 16.4967 21.4375 17.3125 21.4375C18.4062 21.4364 19.4547 21.0014 20.2281 20.2281C21.0014 19.4547 21.4364 18.4062 21.4375 17.3125ZM11.3261 12.2989C11.4551 12.4279 11.6301 12.5004 11.8125 12.5004C11.9949 12.5004 12.1699 12.4279 12.2989 12.2989C12.4279 12.1699 12.5004 11.9949 12.5004 11.8125C12.5004 11.6301 12.4279 11.4551 12.2989 11.3261L10.9239 9.95109C10.7949 9.82209 10.6199 9.74962 10.4375 9.74962C10.2551 9.74962 10.0801 9.82209 9.95109 9.95109C9.82209 10.0801 9.74962 10.2551 9.74962 10.4375C9.74962 10.6199 9.82209 10.7949 9.95109 10.9239L11.3261 12.2989ZM11.3261 22.3261L9.95109 23.7011C9.82209 23.8301 9.74962 24.0051 9.74962 24.1875C9.74962 24.3699 9.82209 24.5449 9.95109 24.6739C10.0801 24.8029 10.2551 24.8754 10.4375 24.8754C10.6199 24.8754 10.7949 24.8029 10.9239 24.6739L12.2989 23.2989C12.3628 23.235 12.4135 23.1592 12.448 23.0757C12.4826 22.9923 12.5004 22.9028 12.5004 22.8125C12.5004 22.7222 12.4826 22.6327 12.448 22.5493C12.4135 22.4658 12.3628 22.39 12.2989 22.3261C12.235 22.2622 12.1592 22.2115 12.0757 22.177C11.9923 22.1424 11.9028 22.1246 11.8125 22.1246C11.7222 22.1246 11.6327 22.1424 11.5493 22.177C11.4658 22.2115 11.39 22.2622 11.3261 22.3261ZM22.8125 12.5C22.9028 12.5001 22.9923 12.4823 23.0757 12.4478C23.1592 12.4133 23.235 12.3627 23.2989 12.2989L24.6739 10.9239C24.8029 10.7949 24.8754 10.6199 24.8754 10.4375C24.8754 10.2551 24.8029 10.0801 24.6739 9.95109C24.5449 9.82209 24.3699 9.74962 24.1875 9.74962C24.0051 9.74962 23.8301 9.82209 23.7011 9.95109L22.3261 11.3261C22.2298 11.4222 22.1643 11.5448 22.1377 11.6782C22.1111 11.8117 22.1247 11.95 22.1768 12.0757C22.2289 12.2014 22.3171 12.3088 22.4303 12.3843C22.5434 12.4598 22.6764 12.5001 22.8125 12.5ZM23.2989 22.3261C23.1699 22.1971 22.9949 22.1246 22.8125 22.1246C22.6301 22.1246 22.4551 22.1971 22.3261 22.3261C22.1971 22.4551 22.1246 22.6301 22.1246 22.8125C22.1246 22.9949 22.1971 23.1699 22.3261 23.2989L23.7011 24.6739C23.765 24.7378 23.8408 24.7885 23.9243 24.823C24.0077 24.8576 24.0972 24.8754 24.1875 24.8754C24.2778 24.8754 24.3673 24.8576 24.4507 24.823C24.5342 24.7885 24.61 24.7378 24.6739 24.6739C24.7378 24.61 24.7885 24.5342 24.823 24.4507C24.8576 24.3673 24.8754 24.2778 24.8754 24.1875C24.8754 24.0972 24.8576 24.0077 24.823 23.9243C24.7885 23.8408 24.7378 23.765 24.6739 23.7011L23.2989 22.3261ZM10.4375 17.3125C10.4375 17.1302 10.3651 16.9553 10.2361 16.8264C10.1072 16.6974 9.93234 16.625 9.75 16.625H7.6875C7.50516 16.625 7.3303 16.6974 7.20136 16.8264C7.07243 16.9553 7 17.1302 7 17.3125C7 17.4948 7.07243 17.6697 7.20136 17.7986C7.3303 17.9276 7.50516 18 7.6875 18H9.75C9.93234 18 10.1072 17.9276 10.2361 17.7986C10.3651 17.6697 10.4375 17.4948 10.4375 17.3125ZM17.3125 24.1875C17.1302 24.1875 16.9553 24.2599 16.8264 24.3889C16.6974 24.5178 16.625 24.6927 16.625 24.875V26.9375C16.625 27.1198 16.6974 27.2947 16.8264 27.4236C16.9553 27.5526 17.1302 27.625 17.3125 27.625C17.4948 27.625 17.6697 27.5526 17.7986 27.4236C17.9276 27.2947 18 27.1198 18 26.9375V24.875C18 24.6927 17.9276 24.5178 17.7986 24.3889C17.6697 24.2599 17.4948 24.1875 17.3125 24.1875ZM26.9375 16.625H24.875C24.6927 16.625 24.5178 16.6974 24.3889 16.8264C24.2599 16.9553 24.1875 17.1302 24.1875 17.3125C24.1875 17.4948 24.2599 17.6697 24.3889 17.7986C24.5178 17.9276 24.6927 18 24.875 18H26.9375C27.1198 18 27.2947 17.9276 27.4236 17.7986C27.5526 17.6697 27.625 17.4948 27.625 17.3125C27.625 17.1302 27.5526 16.9553 27.4236 16.8264C27.2947 16.6974 27.1198 16.625 26.9375 16.625Z" fill="#1C1C1C" />
        </svg>
      ) : (
        <svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="34" height="34" rx="17" fill="#F8F8F8"/>
        <path d="M25.9618 17.79C25.8045 19.4922 25.1657 21.1144 24.1201 22.4668C23.0744 23.8192 21.6653 24.8458 20.0575 25.4265C18.4497 26.0073 16.7098 26.1181 15.0413 25.7461C13.3728 25.3741 11.8448 24.5345 10.636 23.3258C9.42727 22.117 8.58775 20.589 8.21572 18.9205C7.84369 17.252 7.95453 15.5121 8.53528 13.9043C9.11602 12.2965 10.1426 10.8874 11.495 9.84175C12.8474 8.79614 14.4696 8.15731 16.1718 8C15.1752 9.34827 14.6957 11.0094 14.8203 12.6814C14.945 14.3534 15.6657 15.9251 16.8512 17.1106C18.0368 18.2961 19.6084 19.0168 21.2804 19.1415C22.9524 19.2662 24.6135 18.7866 25.9618 17.79Z" stroke="#25282B" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
        </svg>
      )}
    </button>
  );
}
